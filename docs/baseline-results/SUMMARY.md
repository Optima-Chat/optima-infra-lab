# 启动时间基线测试汇总

> **测试日期**: 2026-01-28
> **环境**: ap-southeast-1, t3.small, ECS Optimized AL2023

---

## 基线数据

```
┌─────────────────────────────────────────────────────────────────────┐
│                       启动时间基线汇总                               │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  环节 A: 热池 Task 分配                    基线: ~280ms ✅           │
│  ├─ A1 Gateway 内存分配                   ~1ms                      │
│  ├─ A2 WebSocket 消息                     ~5ms                      │
│  ├─ A3 EFS mkdir                          ~14ms                     │
│  ├─ A4 EFS write                          ~10ms                     │
│  └─ A5 optima 启动                        ~250ms                    │
│                                                                     │
│  环节 B: EC2 Warm → InService             基线: 17s ✅              │
│  ├─ B1 Hibernated → Pending               ~12s                      │
│  ├─ B2 Pending → InService                ~5s                       │
│  └─ B3-B5 Task 调度                       需 Capacity Provider      │
│                                                                     │
│  环节 C: EC2 冷启动                        基线: 81s ✅              │
│  ├─ C1 pending → running                  ~25s (估)                 │
│  ├─ C2 状态检查                           ~35s (估)                 │
│  └─ C6 ECS Agent 注册                     ~20s (估)                 │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

## 详细结果

| 环节 | 描述 | 基线 | 目标 | 差距 |
|------|------|------|------|------|
| **A** | 热池 Task 分配 | **280ms** | <500ms | ✅ 达标 |
| **B** | Warm Pool → InService | **17s** | <15s | ⚠️ 需优化 2s |
| **C** | 冷启动 → InService | **81s** | <90s | ✅ 达标 |

## 关键发现

### 环节 A（热池分配）
- EFS 延迟稳定，mkdir ~14ms，write ~10ms
- optima 启动是主要耗时（~250ms）
- **优化方向**: optima 预加载可降至 <100ms

### 环节 B（Warm Pool 启动）
- Hibernated 状态恢复快（12s 唤醒 + 5s 健康检查 = 17s）
- Task 调度需要额外配置 Capacity Provider 自动扩容
- **优化方向**: 精简 User Data、优化健康检查

### 环节 C（冷启动）
- 实测 81s，比预估 2-5min 快很多
- 主要时间花在 EC2 启动和健康检查
- **优化方向**: Golden AMI、禁用 cloud-init 模块

## 时间对比图

```
环节 A (热池分配):     █ 280ms
环节 B (Warm Pool):    █████████████████ 17s
环节 C (冷启动):       █████████████████████████████████████████████████████████████████████████████████ 81s
```

## 优化策略

### 短期（影响大、成本低）

| 优化项 | 环节 | 预期效果 | 优先级 |
|--------|------|---------|--------|
| Capacity Provider 配置 | B | Task 自动调度 | 高 |
| 精简 User Data | B/C | -5s | 中 |
| 禁用 cloud-init 模块 | C | -10s | 中 |

### 中期（需要开发）

| 优化项 | 环节 | 预期效果 | 优先级 |
|--------|------|---------|--------|
| optima 预加载 | A | 250ms → 50ms | 高 |
| Golden AMI | C | 81s → 40s | 中 |

### 长期（架构优化）

| 优化项 | 环节 | 预期效果 | 优先级 |
|--------|------|---------|--------|
| Task 预热池完整实现 | A | 端到端 <1s | 高 |
| 多 AZ 容量策略 | B/C | 更高可用性 | 低 |

## 下一步

1. [ ] 配置 Capacity Provider 解决 Task 调度问题
2. [ ] 测试 optima 预加载方案
3. [ ] 测试 Golden AMI 效果
4. [ ] 制定容量策略（预热池大小 vs 成本）

---

## 测试报告文件

- `phase-b-20260128-153112.md` - 环节 B 详细报告
- `phase-c-20260128-155925.md` - 环节 C 详细报告
